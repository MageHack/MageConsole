<?php
/**
 * @category    MageHack
 * @package     MageHack_MageConsole
 * @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?php $helper = Mage::helper('mageconsole'); ?>
<?php if ($helper->isEnabled()): ?>
    <form method="post" action="" id="terminalForm">
        <input name="form_key" type="hidden" value="<?php echo $this->getFormKey() ?>" />
        <input name="request" type="hidden" value="" id="terminalCmd" />
    </form>
    <div id="terminal"></div>
    <script type="text/javascript">
    //<![CDATA[
        jQuery(function($, undefined) {
            $('#terminal').terminal(function(cmd, term) {
                if (cmd !== '') {
                    jQuery('#terminalCmd').val(cmd);
                    try {
                        $.ajax({
                            type: "POST",
                            data: $('#terminalForm').serialize(),
                            dataType: 'json',
                            url: "<?php echo $this->getSubmitUrl(); ?>",
                        }).done(function (data) {
                            if(data && data.status == 'OK') {
                                term.echo(data.message);
                            } else {
                                term.error(new String(data.message));
                            }
                        });
                    } catch(e) {
                        term.error(new String(e));
                    }
                }
            }, {
                greetings: 'Magento Console',
                name: 'mageconsole',
                height: 200,
                tabcompletion: true,
                prompt: 'Mage> '});
        });
    //]]>
    </script>
<?php endif; ?>
